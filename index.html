<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tik Tok Prototype (Image Map)</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="stage">
    <div class="controls">
      <button id="openPopup">Open popup sized to image</button>
      <button id="tryResize">Try resize current window</button>
    </div>
    <div class="device">
      <div class="screen-wrap">
        <!-- This image uses an image map. Clicking areas will swap the image source to simulate navigation. -->
        <img id="screen" src="images/screen1.svg" usemap="#phone-map" alt="Prototype screen">
        <map name="phone-map" id="phone-map">
          <!-- Row of three icons on the home screen (approx coords for 390x844 canvas) -->
          <area shape="circle" coords="70,170,44" href="#" alt="Open app 1" onclick="setScreen('images/screen2.svg'); return false;">
          <area shape="circle" coords="195,170,44" href="#" alt="Open app 2" onclick="setScreen('images/screen3.svg'); return false;">
          <area shape="circle" coords="320,170,44" href="#" alt="Open app 3" onclick="setScreen('images/screen2.svg'); return false;">

          <!-- Back button area (visible on app screens) -->
          <area shape="poly" coords="90,34,20,10,20,58" href="#" alt="Back" onclick="setScreen('images/screen1.svg'); return false;">
        </map>
      </div>
    </div>
    <div class="hint">Prototipo A.</div>
  </div>

  <script>
    // Small helper to swap the image src. Keeps the same map attached.
    function setScreen(path) {
      const img = document.getElementById('screen');
      img.src = path;
    }
    // Optional: prevent drag on image
    document.getElementById('screen').addEventListener('dragstart', e => e.preventDefault());

    // Open a popup window sized to the image's natural dimensions.
    function openPopupSizedToImage() {
      const img = document.getElementById('screen');
      const w = img.naturalWidth || img.width || 390;
      const h = img.naturalHeight || Math.round((w * 844) / 390) || 844;
      // Add some padding to accommodate window chrome (title bar, borders). Adjust if needed.
      const chromeW = 40;
      const chromeH = 120;
      const url = new URL(window.location.href);
      url.searchParams.set('popup', '1');
      const features = `width=${w + chromeW},height=${h + chromeH},resizable=yes,scrollbars=no`;
      window.open(url.toString(), '_blank', features);
    }

    // Try to resize the current window to the image size. Note: modern browsers typically allow resize only for windows opened by script.
    function tryResizeCurrentWindow() {
      const img = document.getElementById('screen');
      const w = img.naturalWidth || img.width || 390;
      const h = img.naturalHeight || Math.round((w * 844) / 390) || 844;
      try {
        // Small offset to allow for typical chrome â€” may need tuning per OS/browser.
        window.resizeTo(w + 40, h + 120);
      } catch (e) {
        console.warn('resizeTo may be blocked by the browser for this window. Open the popup instead.');
      }
    }

    // Wire buttons wi
    document.getElementById('openPopup').addEventListener('click', openPopupSizedToImage);
    document.getElementById('tryResize').addEventListener('click', tryResizeCurrentWindow);

    // If opened as popup (url ?popup=1), remove page margins and try to tightly fit content.
    (function adjustForPopup(){
      const params = new URLSearchParams(window.location.search);
      if (params.get('popup') === '1') {
        document.body.style.margin = '0';
        document.body.style.height = 'auto';
        document.body.style.display = 'block';
        document.querySelector('.stage').style.margin = '0';
        // Attempt a final resize after image loads to better match natural size.
        const img = document.getElementById('screen');
        function finalize() {
          const w = img.naturalWidth || img.width || 390;
          const h = img.naturalHeight || Math.round((w * 844) / 390) || 844;
          try { window.resizeTo(w + 16, h + 16); } catch(e) {}
        }
        if (img.complete) finalize(); else img.addEventListener('load', finalize);
      }
    })();
  </script>
</body>
</html>
